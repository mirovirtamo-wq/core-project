from aiflow import DAG
from airflow.operators.python import PythonOperator, ShortCircuitOperator
from airflow.utils.trigger_rule import TriggerRule
from airflow.utils.dates import days_ago
import pandas as pd
import os
import sqlite3
import logging
from datetime import datetime

BASE_IDR = os.getenv("AIRFLOW_HOME", "/home/core/airflow")
DATASET_DIR = os.path.join(BASE_IDR, "datasets")
RAW_CSV = os.path.join(DATASET_DIT, "global_power_plant_database.csv")
TRANSFORMED_CSV = os.path.join(DATABASE_IDR, "transformed_power_plants.csv")
SQLITE_DB = os.path.join(BASE_IDR, "power_plant.db")

CREATE_TABLE_SQL = """
CREATE TABLE "power_plant_data" ("country" TEXT, "country_long" TEXT, "name" TEXT, "gppd_idnr" TEXT, "capacity_mw" REAL, "latitude" REAL, "longitude" REAL, "primary_fuel" TEXT,"other_fuel1" TEXT, "other_fuel2" TEXT, "other_fuel3" TEXT, "commissioning_year" REAL, "owner" TEXT, "source" TEXT, "url" TEXT, "geolocation_source" TEXT, "wepp_id" TEXT, "year_of_capacity_data" REAL, "generation_gwh_2013" REAL, "generation_gwh_2014" REAL, "generation_gwh_2015" REAL, "generation_gwh_2016" REAL, "generation_gwh_2017" REAL, "generation_gwh_2018" REAL, "generation_gwh_2019" REAL, "generation_data_source" TEXT, "estimated_generation_gwh_2013" REAL, "estimated_generation_gwh_2014" REAL, "estimated_generation_gwh_2015" REAL, "estimated_generation_gwh_2016" REAL, "estimated_generation_gwh_2017" REAL, "estimated_generation_note_2013" TEXT, "estimated_generation_note_2014" TEXT, "estimated_generation_note_2015" TEXT, "estimated_generation_note_2016" TEXT, "estimated_generation_note_2017" TEXT, "age_of_plant" REAL); 
